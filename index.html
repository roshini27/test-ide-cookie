<!DOCTYPE html>
<html>
<head>
  <title>Facebook + Analytics Test</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">

  <style>
    body {
      font-family: "Roboto", sans-serif;
      text-align: center;
      margin-top: 60px;
    }
  </style>

  <!-- ✅ CMP -->
  <script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js"
    type="text/javascript"
    charset="UTF-8"
    data-domain-script="0195138c-cdc8-738c-907d-131dad8db9ba-test">
  </script>

  <script>
    function OptanonWrapper() {
      console.log("✅ OneTrust consent ready");
    }
  </script>

  <!-- ✅ META PIXEL (GUARANTEED LOAD) -->
  <script>
  (function() {
    var s = document.createElement("script");
    s.async = true;
    s.src = "https://connect.facebook.net/en_US/fbevents.js";

    s.onload = function() {
      console.log("✅ META SCRIPT LOADED");

      if (typeof fbq !== "function") {
        console.error("❌ fbq STILL undefined after load");
        return;
      }

      fbq('init', '101937259');   // ✅ YOUR PIXEL ID
      fbq('track', 'PageView');

      console.log("✅ fbq initialized");
      console.log("✅ Meta PageView sent");
    };

    s.onerror = function() {
      console.error("❌ Failed to load Facebook script");
    };

    document.head.appendChild(s);
  })();
  </script>

  <noscript>
    <img height="1" width="1" style="display:none"
      src="https://www.facebook.com/tr?id=101937259&ev=PageView&noscript=1"/>
  </noscript>

  <!-- ✅ ANALYTICS.JS (NO GOOGLE SYNC FLAGS) -->
  <script 
    type="text/javascript"
    src="https://web-analytics-js5-dot-uxlwqzc-cdip-sandbox-test.uc.r.appspot.com/static/analytics.js?facebookCookieSyncFlag=true&automaticTracking=true&dataLayer=dataLayer&backendBaseUrl=https%3A%2F%2Fweb-analytics-dot-uxlwqzc-cdip-sandbox-test.uc.r.appspot.com">
  </script>

</head>

<body>

  <h1>✅ Facebook + Analytics Test Page</h1>
  <p>No Google sync on this page</p>
  <p>Open DevTools → Console + Network</p>

  <button onclick="fireTestEvent()" class="w3-button w3-green w3-large">
    Send Test Event
  </button>

  <script>
    function fireTestEvent() {
      if (typeof fbq === "function") {
        fbq('track', 'Purchase', { value: 199, currency: 'INR' });
        console.log(" Meta Purchase Event Fired");
      } else {
        console.log(" fbq not available");
      }

      console.log(" Analytics.js event should also fire now");
    }
  </script>

</body>
</html>
