<!DOCTYPE html>
<html>
<head>
  <title>DoubleClick Cookie Sync – Visible 302 Version</title>
</head>
<body>
<h2>DoubleClick Cookie Sync – Visible 302 Version</h2>
<p>Open DevTools → Network + Application → Cookies (.doubleclick.net)</p>

<script>
const GOOGLE_NETWORK_ID = "1686285891"; // no hyphens

async function sha1(message) {
  const data = new TextEncoder().encode(message);
  const hash = await crypto.subtle.digest("SHA-1", data);
  return Array.from(new Uint8Array(hash))
    .map(b => b.toString(16).padStart(2, "0"))
    .join("");
}

(async () => {
  // generate some user ID (just for testing)
  const uid = "user_" + Math.random().toString(36).substring(2);

  // hash it (Google requires SHA1 hex)
  const hashed = await sha1(uid);

  // redirect param -> causes a real visible 302
  const redirect = encodeURIComponent("https://example.com/sync_done");

  // FULL GOOGLE SYNC URL (with tag_debug=1 to expose redirects)
  const pixelUrl =
    "https://cm.g.doubleclick.net/pixel?" +
    "google_nid=" + GOOGLE_NETWORK_ID +
    "&google_hm=" + hashed +
    "&redirect=" + redirect +
    "&tag_debug=1";

  console.log("Triggering sync:", pixelUrl);

  // IMPORTANT: using iframe instead of <img> will SHOW THE 302 VISIBLY
  const iframe = document.createElement("iframe");
  iframe.src = pixelUrl;
  iframe.width = 0;
  iframe.height = 0;
  iframe.style.border = "none";
  iframe.style.display = "none";

  document.body.appendChild(iframe);
})();
</script>

</body>
</html>
